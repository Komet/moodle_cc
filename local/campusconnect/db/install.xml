<?xml version="1.0" encoding="UTF-8" ?>
<XMLDB PATH="local/campusconnect/db" VERSION="20120626" COMMENT="XMLDB file for Moodle local/campusconnect"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="../../../lib/xmldb/xmldb.xsd"
>
  <TABLES>
    <TABLE NAME="local_campusconnect_ecs" COMMENT="Settings for connecting to different ECS" NEXT="local_campusconnect_eventin">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" UNSIGNED="true" SEQUENCE="true" NEXT="name"/>
        <FIELD NAME="name" TYPE="text" LENGTH="small" NOTNULL="false" SEQUENCE="false" COMMENT="The local name used to identify this ECS" PREVIOUS="id" NEXT="url"/>
        <FIELD NAME="url" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="The URL of the ECS" PREVIOUS="name" NEXT="auth"/>
        <FIELD NAME="auth" TYPE="int" LENGTH="3" NOTNULL="false" UNSIGNED="false" DEFAULT="2" SEQUENCE="false" COMMENT="The type of authentication to use (1 = none, 2 = http, 3 = certificate)" PREVIOUS="url" NEXT="ecsauth"/>
        <FIELD NAME="ecsauth" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="The ecsauth name to add to the header when using no authentication" PREVIOUS="auth" NEXT="httpuser"/>
        <FIELD NAME="httpuser" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="The username to use with basic http auth" PREVIOUS="ecsauth" NEXT="httppass"/>
        <FIELD NAME="httppass" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="The password to use with basic http auth" PREVIOUS="httpuser" NEXT="cacertpath"/>
        <FIELD NAME="cacertpath" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="The path to the CA certificate when using certificate authentication" PREVIOUS="httppass" NEXT="certpath"/>
        <FIELD NAME="certpath" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="The certificate path to use with certificate authentication" PREVIOUS="cacertpath" NEXT="keypath"/>
        <FIELD NAME="keypath" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="The path to the key file for use with certificate authentication." PREVIOUS="certpath" NEXT="keypass"/>
        <FIELD NAME="keypass" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="The key password for use with certificate authentication." PREVIOUS="keypath" NEXT="crontime"/>
        <FIELD NAME="crontime" TYPE="int" LENGTH="10" NOTNULL="false" UNSIGNED="false" DEFAULT="0" SEQUENCE="false" COMMENT="How often to check for updates from this ECS server (in seconds)" PREVIOUS="keypass" NEXT="lastcron"/>
        <FIELD NAME="lastcron" TYPE="int" LENGTH="10" NOTNULL="false" UNSIGNED="false" DEFAULT="0" SEQUENCE="false" COMMENT="The last time we checked for updates from this ECS server" PREVIOUS="crontime" NEXT="importcategory"/>
        <FIELD NAME="importcategory" TYPE="int" LENGTH="10" NOTNULL="false" UNSIGNED="false" SEQUENCE="false" COMMENT="The course category id to put imported courses into" PREVIOUS="lastcron" NEXT="importrole"/>
        <FIELD NAME="importrole" TYPE="char" LENGTH="100" NOTNULL="false" SEQUENCE="false" COMMENT="The shortname of the role to assign to incoming users" PREVIOUS="importcategory" NEXT="importperiod"/>
        <FIELD NAME="importperiod" TYPE="int" LENGTH="6" NOTNULL="false" UNSIGNED="false" DEFAULT="6" SEQUENCE="false" COMMENT="The number of months to keep imported users active" PREVIOUS="importrole" NEXT="notifyusers"/>
        <FIELD NAME="notifyusers" TYPE="text" LENGTH="medium" NOTNULL="false" SEQUENCE="false" COMMENT="Comma-separated list of email addresses to notify about new users via ECS" PREVIOUS="importperiod" NEXT="notifycontent"/>
        <FIELD NAME="notifycontent" TYPE="text" LENGTH="medium" NOTNULL="false" SEQUENCE="false" COMMENT="Comma-separated list of email addresses to notify about new external courses via ECS" PREVIOUS="notifyusers" NEXT="notifycourses"/>
        <FIELD NAME="notifycourses" TYPE="text" LENGTH="medium" NOTNULL="false" SEQUENCE="false" COMMENT="Comma-separated list of email addresses to notify about newly exported courses via ECS" PREVIOUS="notifycontent"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id" NEXT="importcategory"/>
        <KEY NAME="importcategory" TYPE="foreign" FIELDS="importcategory" REFTABLE="course_categories" REFFIELDS="id" PREVIOUS="primary"/>
      </KEYS>
    </TABLE>
    <TABLE NAME="local_campusconnect_eventin" COMMENT="Stores incoming events from the ECS server, until they have been processed" PREVIOUS="local_campusconnect_ecs" NEXT="local_campusconnect_clink">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" UNSIGNED="true" SEQUENCE="true" NEXT="type"/>
        <FIELD NAME="type" TYPE="char" LENGTH="30" NOTNULL="false" SEQUENCE="false" COMMENT="The resource type the event is linked to" PREVIOUS="id" NEXT="resourceid"/>
        <FIELD NAME="resourceid" TYPE="int" LENGTH="10" NOTNULL="false" UNSIGNED="false" SEQUENCE="false" COMMENT="The ID of the resource on the ECS server" PREVIOUS="type" NEXT="serverid"/>
        <FIELD NAME="serverid" TYPE="int" LENGTH="10" NOTNULL="false" UNSIGNED="false" SEQUENCE="false" COMMENT="The ECS server this event came from" PREVIOUS="resourceid" NEXT="status"/>
        <FIELD NAME="status" TYPE="char" LENGTH="20" NOTNULL="false" SEQUENCE="false" COMMENT="The status of the event ('created', 'updated', 'destroyed', 'new_export')" PREVIOUS="serverid"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id" NEXT="serverid"/>
        <KEY NAME="serverid" TYPE="foreign" FIELDS="serverid" REFTABLE="local_campusconnect_ecs" REFFIELDS="id" PREVIOUS="primary"/>
      </KEYS>
    </TABLE>
    <TABLE NAME="local_campusconnect_clink" COMMENT="Stores information about course links" PREVIOUS="local_campusconnect_eventin" NEXT="local_campusconnect_part">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" UNSIGNED="true" SEQUENCE="true" NEXT="courseid"/>
        <FIELD NAME="courseid" TYPE="int" LENGTH="10" NOTNULL="false" UNSIGNED="false" SEQUENCE="false" COMMENT="The ID of the 'fake' course that will redirect to this link" PREVIOUS="id" NEXT="url"/>
        <FIELD NAME="url" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="The external URL to redirect to" PREVIOUS="courseid" NEXT="resourceid"/>
        <FIELD NAME="resourceid" TYPE="int" LENGTH="10" NOTNULL="false" UNSIGNED="false" SEQUENCE="false" COMMENT="The ID of this course link on the ECS server" PREVIOUS="url" NEXT="ecsid"/>
        <FIELD NAME="ecsid" TYPE="int" LENGTH="10" NOTNULL="false" UNSIGNED="false" SEQUENCE="false" COMMENT="The ID of the ECS server that this link came from" PREVIOUS="resourceid" NEXT="mid"/>
        <FIELD NAME="mid" TYPE="int" LENGTH="10" NOTNULL="false" UNSIGNED="false" SEQUENCE="false" COMMENT="The member ID of the site this course came from" PREVIOUS="ecsid"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id" NEXT="courseid"/>
        <KEY NAME="courseid" TYPE="foreign" FIELDS="courseid" REFTABLE="course" REFFIELDS="id" PREVIOUS="primary" NEXT="ecsid"/>
        <KEY NAME="ecsid" TYPE="foreign" FIELDS="ecsid" REFTABLE="local_campusconnect_ecs" REFFIELDS="id" PREVIOUS="courseid"/>
      </KEYS>
    </TABLE>
    <TABLE NAME="local_campusconnect_part" COMMENT="Settings for participants in an ECS" PREVIOUS="local_campusconnect_clink" NEXT="local_campusconnect_mappings">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" UNSIGNED="true" SEQUENCE="true" NEXT="ecsid"/>
        <FIELD NAME="ecsid" TYPE="int" LENGTH="10" NOTNULL="false" UNSIGNED="false" SEQUENCE="false" COMMENT="ECS that this participant is found on" PREVIOUS="id" NEXT="mid"/>
        <FIELD NAME="mid" TYPE="int" LENGTH="10" NOTNULL="false" UNSIGNED="false" SEQUENCE="false" COMMENT="The ID of the participant in the community on the ECS server" PREVIOUS="ecsid" NEXT="export"/>
        <FIELD NAME="export" TYPE="int" LENGTH="4" NOTNULL="false" UNSIGNED="false" DEFAULT="0" SEQUENCE="false" COMMENT="Should courses be exported to this participant?" PREVIOUS="mid" NEXT="import"/>
        <FIELD NAME="import" TYPE="int" LENGTH="4" NOTNULL="false" UNSIGNED="false" DEFAULT="0" SEQUENCE="false" COMMENT="Should course be imported from this participant?" PREVIOUS="export" NEXT="importtype"/>
        <FIELD NAME="importtype" TYPE="int" LENGTH="4" NOTNULL="false" UNSIGNED="false" DEFAULT="1" SEQUENCE="false" COMMENT="How to treat courses imported from this participant" PREVIOUS="import" NEXT="displayname"/>
        <FIELD NAME="displayname" TYPE="text" LENGTH="small" NOTNULL="false" SEQUENCE="false" PREVIOUS="importtype"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id" NEXT="ecsid"/>
        <KEY NAME="ecsid" TYPE="foreign" FIELDS="ecsid" REFTABLE="local_campusconnect_ecs" REFFIELDS="id" PREVIOUS="primary"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="ecsid_mid" UNIQUE="true" FIELDS="ecsid, mid"/>
      </INDEXES>
    </TABLE>
    <TABLE NAME="local_campusconnect_mappings" COMMENT="Stores the metadata mappings for each ECS course import/export" PREVIOUS="local_campusconnect_part">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" UNSIGNED="true" SEQUENCE="true" NEXT="field"/>
        <FIELD NAME="field" TYPE="char" LENGTH="50" NOTNULL="false" SEQUENCE="false" COMMENT="The destination field for the mapping" PREVIOUS="id" NEXT="setto"/>
        <FIELD NAME="setto" TYPE="text" LENGTH="small" NOTNULL="false" SEQUENCE="false" COMMENT="The field / string to set the destination field to" PREVIOUS="field" NEXT="ecsid"/>
        <FIELD NAME="ecsid" TYPE="int" LENGTH="10" NOTNULL="false" UNSIGNED="false" SEQUENCE="false" COMMENT="The ECS this mapping is associated with" PREVIOUS="setto" NEXT="type"/>
        <FIELD NAME="type" TYPE="int" LENGTH="4" NOTNULL="false" UNSIGNED="false" SEQUENCE="false" COMMENT="The type of mapping (1 = import_course, 2 = import_external_course, 3 = export_course, 4 = export_external_course)" PREVIOUS="ecsid"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id" NEXT="ecsid"/>
        <KEY NAME="ecsid" TYPE="foreign" FIELDS="ecsid" REFTABLE="local_campusconnect_ecs" REFFIELDS="id" PREVIOUS="primary"/>
      </KEYS>
    </TABLE>
  </TABLES>
</XMLDB>